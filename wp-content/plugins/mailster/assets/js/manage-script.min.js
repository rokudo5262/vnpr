mailster=function(e,t,n,r){"use strict";var i=t(".import-status"),a=t(".export-status"),s=t("#progress"),o=s.find(".bar"),l=t("#mailster_nonce").val(),d=null,u=0,p,c,f=function(){var n=new plupload.Uploader(wpUploaderInit);n.bind("Init",function(e){var n=t("#plupload-upload-ui");if(e.features.dragdrop&&!t(r.body).hasClass("mobile")){n.addClass("drag-drop");t("#drag-drop-area").bind("dragover.wp-uploader",function(){n.addClass("drag-over")}).bind("dragleave.wp-uploader, drop.wp-uploader",function(){n.removeClass("drag-over")})}else{n.removeClass("drag-drop");t("#drag-drop-area").unbind(".wp-uploader")}if(e.runtime=="html4")t(".upload-flash-bypass").hide()});n.bind("FilesAdded",function(e,n){t("#media-upload-error").html("");t("#wordpress-users").fadeOut();setTimeout(function(){e.refresh();e.start()},1)});n.bind("BeforeUpload",function(e,t){s.removeClass("finished error hidden");i.html("uploading")});n.bind("UploadFile",function(e,t){});n.bind("UploadProgress",function(t,n){i.html(e.util.sprintf(e.l10n.manage.uploading,n.percent+"%"));o.stop().animate({width:n.percent+"%"},100)});n.bind("Error",function(e,t){i.html(t.message);s.addClass("error");e.refresh()});n.bind("FileUploaded",function(e,r,a){a=t.parseJSON(a.response);c=a.identifier;if(!a.success){i.html(a.message);s.addClass("error");e.refresh();n.unbind("UploadComplete")}});n.bind("UploadComplete",function(t,n){i.html(e.l10n.manage.prepare_data);s.addClass("finished");b()});n.init()};typeof wpUploaderInit=="object"&&e.events.push("documentReady",f);t(".wrap").on("change","#signup",function(){t("#signupdate").prop("disabled",!t(this).is(":checked"))}).on("click",".do-import",function(){var r=t("#lists").serialize(),a=t("#subscriber-table").serialize();if(!/%5D=email/.test(a)){alert(e.l10n.manage.select_emailcolumn);return false}if(!t('input[name="status"]:checked').length){alert(e.l10n.manage.select_status);return false}if(!confirm(e.l10n.manage.confirm_import))return false;var l=t(this).prop("disabled",true),d=t('input[name="status"]:checked').val(),u=t('input[name="existing"]:checked').val(),c=t("#signup").is(":checked"),f=t("#signupdate").val(),m=t("#keepstatus").is(":checked"),h=t("#import-ajax-loading").css({display:"inline-block"}),b=t("#identifier").val(),v=t("#performance").is(":checked");s.removeClass("hidden");o.stop().width(0);t(".step1").slideUp();t(".step2-body").html("<br><br>").parent().show();p=new Date;g(0,{identifier:b,order:a,lists:r,status:d,keepstatus:m,existing:u,signupdate:c?f:null,performance:v});i.html(e.l10n.manage.prepare_import);n.onbeforeunload=function(){return e.l10n.manage.onbeforeunloadimport}}).on("change",".wordpress-users-toggle",function(){t(this).parent().parent().parent().find("li input").prop("checked",t(this).prop("checked"))}).on("click","#addlist",function(){var e=t("#new_list_name").val();if(!e)return false;t('<li><label><input name="lists[]" value="'+e+'" type="checkbox" checked> '+e+" </label></li>").appendTo("#lists > ul");t("#new_list_name").val("")}).on("change",".list-toggle",function(){t(this).parent().parent().parent().find("ul input").prop("checked",t(this).prop("checked"))}).on("change",'input[name="status"]',function(){if(t(this).val()<=0){t(".pending-info").show()}else{t(".pending-info").hide()}});t("#paste-import").on("focus",function(){t(this).val("").addClass("focus")}).on("blur",function(){t(this).removeClass("focus");var n=t.trim(t(this).val());if(n){e.util.ajax("import_subscribers_upload_handler",{data:n},function(e){if(e.success){c=e.identifier;t("#wordpress-users").fadeOut();b()}else{i.html(e.message);s.addClass("error")}},function(){i.html("Error")})}});t("#import_wordpress").on("submit",function(){var n=t(this).serialize();e.util.ajax("import_subscribers_upload_handler",{wordpressusers:n},function(e){if(e.success){c=e.identifier;t("#wordpress-users").fadeOut();b()}else{i.html(e.message);s.addClass("error")}},function(){i.html("Error")});return false});t('select[name="outputformat"]').on("change",function(){t("#csv-separator")[t(this).val()=="csv"?"show":"hide"]()});e.events.push("documentReady",function(){t.fn.sortable&&t(".export-order").sortable({connectWith:".export-order",_placeholder:"ui-state-highlight",containment:".export-order-wrap",receive:function(e,t){t.item.find("input").prop("checked",t.item.closest(".export-order").is(".selected"))}}).on("change","input",function(){var e=t(this);e.parent().appendTo(e.is(":checked")?t(".export-order.selected"):t(".export-order.unselected"))})});t(".export-order-wrap").on("click",".export-order-add",function(){t(".export-order.unselected").find("li").appendTo(".export-order.selected").find("input").prop("checked",true);return false}).on("click",".export-order-remove",function(){t(".export-order.selected").find("li").appendTo(".export-order.unselected").find("input").prop("checked",false);return false});t("#export-subscribers").on("submit",function(){var r=t(this).serialize();e.util.ajax("export_contacts",{data:r},function(i){if(i.success){n.onbeforeunload=function(){return e.l10n.manage.onbeforeunloadexport};var a=t(".performance").val();t(".step2").slideDown();t(".step2-body").html(e.util.sprintf(e.l10n.manage.write_file,"0.00 Kb"));s.removeClass("finished error hidden");o.stop().width(0);h(0,a,i.count,r)}else{alert(i.msg)}},function(e,t,n){alert(t)});return false});t("#delete-subscribers").on("submit",function(){var n=prompt(e.l10n.manage.confirm_delete,"");if(!n)return false;if("delete"==n.toLowerCase()){var r=t(this).serialize();s.removeClass("finished error hidden");o.stop().animate({width:"99%"},25e3);e.util.ajax("delete_contacts",{data:r},function(e){if(e.success){o.stop().animate({width:"100%"},200,function(){t(".delete-status").html(e.msg);s.addClass("finished")})}else{o.stop();t(".delete-status").html(e.msg);s.addClass("error")}},function(e,n,r){o.stop();t(".delete-status").html("["+e.status+"] "+r);s.addClass("error")})}return false});t("#delete-subscribers").on("change","input, select",m);m();function m(){setTimeout(function(){var n=t("#delete-subscribers").serialize();t("#delete-subscriber-button").prop("disabled",true);e.util.ajax("get_subscriber_count",{data:n},function(n){if(n.success){t("#delete-subscriber-button").val(e.util.sprintf(e.l10n.manage.delete_n_subscribers,n.count)).prop("disabled",!n.count)}})},10)}t("input.selectall").on("change",function(){var e=t(this),n=e.attr("name");t('input[name="'+n+'"]').prop("checked",e.prop("checked"))});function h(i,l,d,u){var p=(new Date).getTime(),c=Math.min(1,l*i/d)*100;a.html(e.util.sprintf(e.l10n.manage.prepare_download,d,""));e.util.ajax("do_export",{limit:l,offset:i,data:u},function(p){var f=c>=100&&p.finished;if(p.success){if(!f)h(i+1,l,d,u);o.animate({width:c+"%"},{duration:1e3,easing:"swing",queue:false,step:function(t){a.html(e.util.sprintf(e.l10n.manage.prepare_download,d,Math.ceil(t)+"%"))},complete:function(){a.html(e.util.sprintf(e.l10n.manage.prepare_download,d,Math.ceil(c)+"%"));if(f){n.onbeforeunload=null;s.addClass("finished");t(".step2-body").html(e.l10n.manage.export_finished);a.html(e.util.sprintf(e.l10n.manage.downloading,d));if(p.filename)setTimeout(function(){r.location=p.filename},1e3)}else{t(".step2-body").html(e.util.sprintf(e.l10n.manage.write_file,p.total))}}})}else{o.stop();s.addClass("error");n.onbeforeunload=null;a.html(e.l10n.manage.error_export);t(".step2-body").html(p.msg)}},function(e,t,n){})}function g(r,a){var l=0;if(!r)r=0;e.util.ajax("do_import",{id:r,options:a},function(d){l=Math.min(1,(d.imported+d.errors)/d.total)*100;t(".step2-body").html("<p>"+w(d.f_imported,d.f_errors,d.f_total,l,d.memoryusage)+"</p>");u=0;var p=l>=100;if(d.success){if(!p)g(r+1,a);o.animate({width:l+"%"},{duration:1e3,easing:"swing",queue:false,step:function(t){i.html(e.util.sprintf(e.l10n.manage.import_contacts,Math.ceil(t)+"%"))},complete:function(){i.html(e.util.sprintf(e.l10n.manage.import_contacts,Math.ceil(l)+"%"));if(p){n.onbeforeunload=null;s.addClass("finished");t(".step2-body").html(d.html).slideDown()}}})}else{v(l,r,a)}},function(e,t,n){v(l,r,a)})}function b(){s.removeClass("finished error");e.util.ajax("get_import_data",{identifier:c},function(e){s.addClass("hidden");t(".step1").slideUp();t(".step2-body").html(e.html).parent().show();t("input.datepicker").datepicker({dateFormat:"yy-mm-dd",showAnim:"fadeIn",onClose:function(){}});i.html("");d=e.data})}function v(t,r,a){u++;if(u>=5){alert(e.l10n.manage.error_importing);n.onbeforeunload=null;return}var o=u*5,l="",d=setInterval(function(){if(o<=0){clearInterval(d);s.removeClass("paused");g(r,a);l=Math.round(t)+"%"}else{s.addClass("paused");l='<span class="error">'+e.util.sprintf(e.l10n.manage.continues_in,o--)+"</span>"}i.html(e.util.sprintf(e.l10n.manage.import_contacts,l))},1e3)}function w(t,n,r,i,a){var s=(new Date).getTime()-p.getTime(),o=Math.ceil((100-i)*(s/i)/6e4);return e.util.sprintf(e.l10n.manage.current_stats,"<strong>"+t+"</strong>","<strong>"+r+"</strong>","<strong>"+n+"</strong>","<strong>"+a+"</strong>")+"<br>"+e.util.sprintf(e.l10n.manage.estimate_time,o)}return e}(mailster||{},jQuery,window,document);
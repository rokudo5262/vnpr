!function(i){"use strict";var t=i("#wud-my-account-form"),e=i("#wud-form-document");i(".wud-theme-table").zufusiontable({breakpoint:{xs:480,sm:576,md:992,lg:1200,xlg:1400}});var a=[],n=i.parseJSON(wud_vars.tags);i.isEmptyObject(n)||i.each(n,function(e,t){a.push({tag:t,value:e})}),i("#wud-form-document #tags").amsifySuggestags({type:"amsify",suggestions:a}),i(".wud-multiple").select2(),i("#wud-remove-post-thumbnail").on("click",function(e){e.preventDefault();var t=i(this),a=i(this).closest("#forms_field_post_image"),n=i("#_thumbnail_id",a),r=i("#doc_image",a),s=i(".description",a);a.find("img").remove(),n.val(-1),r.addClass("wud-show"),r.attr("data-parsley-required",!0),s.addClass("wud-show"),t.addClass("wud-hide")});var r=i("#captcha"),s=i("#forms_field_spam"),o=Math.round(8*Math.random())+1,d=Math.round(8*Math.random())+1,l=o+d;s.find("label").text(o+" + "+d+" = ?"),r.attr("data-parsley-captcha",l),window.Parsley.addValidator("captcha",{requirementType:"integer",validateNumber:function(e,t){return e===t},messages:{en:wud_vars.translate.incorrect_response}}),window.Parsley.addValidator("maxfilesize",{validateString:function(e,t,a){if(!window.FormData)return alert("You are making all developpers in the world cringe. Upgrade your browser!"),!0;var n=a.$element[0].files;return 1!=n.length||n[0].size/1048576<=parseInt(t)},requirementType:"string",messages:{en:wud_vars.translate.max_file_size}}),window.Parsley.addValidator("fileextension",{validateString:function(e,t,a){var n=t.split(","),r=e.split(".").pop().toLowerCase(),s=[];return i.each(n,function(e,t){s.push(t.toLowerCase())}),"-1"!=i.inArray(r,s)},messages:{en:wud_vars.translate.fileextension}}),0<e.find("form").length&&(e.find("form").parsley().on("form:submit",function(e){i("#wud-overlay-loading").show()}),i("#wud-delete-doc").on("click",function(e){e.preventDefault();var t=i(this);confirm(wud_vars.translate.are_you_sure)&&(i("#wud-overlay-loading").show(),window.location=t.attr("href"))}));i(document).on("click",".wud-button-like",function(){var s,e=i(this),t=e.attr("data-post-id"),a=e.attr("data-nonce"),n=e.attr("data-iscomment"),o=(s=i("1"===n?".wud-comment-button-"+t:".wud-button-like-"+t)).next("#wud-loader");return""!==t&&i.ajax({type:"POST",url:wud_vars.ajaxurl+"&controller=doc&task=like",data:{post_id:t,nonce:a,is_comment:n},beforeSend:function(){o.html('&nbsp;<div class="wud-loading">Loading...</div>')},success:function(e){var t=e.icon,a=e.count;if(s.html(t+a),"unliked"===e.status){var n=wud_vars.like;s.prop("title",n),s.removeClass("liked")}else{var r=wud_vars.unlike;s.prop("title",r),s.addClass("liked")}o.empty()}}),!1}),i(document).on("click",".wud-search-button",function(){i(this).closest("form").submit()}),i(".wud-documents-toolbar .filter-form select").on("change",function(){i(this).closest("form").submit()}),i("#cb-select-all").on("click",function(){var e=i(this),t=e.closest("table");e.is(":checked")?t.find('input[type="checkbox"]').prop("checked",!0):t.find('input[type="checkbox"]').prop("checked",!1)}),i("#wud-delete-docs").on("click",function(e){if(e.preventDefault(),0<t.find(".post-checkbox:checked").length){if(!confirm(wud_vars.translate.delete_document))return!1;t.submit()}t.submit()}),i("#group_id").on("change",function(){i.ajax({type:"POST",dataType:"json",url:wud_vars.admin_ajaxurl+"&controller=doc&task=getaccessoptions",data:{group_id:i(this).val()},success:function(e){i("#visibility_by").html(e.access_options),i("#comment_by").html(e.access_options),i("#edit_by").html(e.edit_option)}})});var c=i("#share-email-form");c.length&&c.parsley().on("form:submit",function(e){var t=c.find("#send_email");return i.ajax({url:wud_vars.ajaxurl+"&controller=email&task=send",type:"POST",dataType:"json",data:i("#share-email-form").serialize(),beforeSend:function(){t.attr("disabled",!0),c.find("#message_response").text(wud_vars.translate.sending)}}).done(function(e){c.find("#message_response").text(e.message),t.attr("disabled",!1),setTimeout(function(){c.find("#message_response").text("")},5e3)}),!1}),i(document).ready(function(){var r=setInterval(function(){var t=i("#wud-preview-iframe"),a=t.attr("src"),n=!1;try{0<t.contents().find("body").children().length||(t.attr("src",a),clearInterval(r),n=!0)}catch(e){(-1<e.message.indexOf("Blocked a frame with origin")||-1<e.message.indexOf("from accessing a cross-origin frame."))&&(console.log("Same origin Iframe error found!!!"),n||(t.attr("src",a),clearInterval(r)))}},1e3)})}(jQuery);
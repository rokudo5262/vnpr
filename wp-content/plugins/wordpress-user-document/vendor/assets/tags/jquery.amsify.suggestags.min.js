var AmsifySuggestags;!function(s){"object"==typeof module&&"object"==typeof module.exports?s(require("jquery"),window,document):s(jQuery,window,document)}(function(r,e,s,o){(AmsifySuggestags=function(s){this.selector=s,this.settings={type:"bootstrap",tagLimit:-1,suggestions:[],suggestionsAction:{},defaultTagClass:"",classes:[],backgrounds:[],colors:[],whiteList:!1,afterAdd:{},afterRemove:{},selectOnHover:!0,triggerChange:!1,noSuggestionMsg:"",showAllSuggestions:!1},this.method=o,this.name=null,this.defaultLabel="Type here",this.classes={sTagsArea:".amsify-suggestags-area",inputArea:".amsify-suggestags-input-area",inputAreaDef:".amsify-suggestags-input-area-default",focus:".amsify-focus",sTagsInput:".amsify-suggestags-input",listArea:".amsify-suggestags-list",list:".amsify-list",listItem:".amsify-list-item",itemPad:".amsify-item-pad",inputType:".amsify-select-input",tagItem:".amsify-select-tag",colBg:".col-bg",removeTag:".amsify-remove-tag",readyToRemove:".ready-to-remove",noSuggestion:".amsify-no-suggestion"},this.selectors={sTagsArea:null,inputArea:null,inputAreaDef:null,sTagsInput:null,listArea:null,list:null,listGroup:null,listItem:null,itemPad:null,inputType:null},this.ajaxActive=!1,this.tagNames=[]}).prototype={_settings:function(s){this.settings=r.extend(this.settings,s)},_setMethod:function(s){this.method=s},_init:function(){this.checkMethod()&&(this.name=r(this.selector).attr("name")?r(this.selector).attr("name")+"_amsify":"amsify_suggestags",this.createHTML(),this.setEvents(),r(this.selector).hide(),this.setDefault())},createHTML:function(){var s='<div class="'+this.classes.sTagsArea.substring(1)+'"></div>';this.selectors.sTagsArea=r(s).insertAfter(this.selector);var t='<div class="'+this.classes.inputArea.substring(1)+'"></div>';this.selectors.inputArea=r(t).appendTo(this.selectors.sTagsArea),this.defaultLabel=r(this.selector).attr("placeholder")!==o?r(this.selector).attr("placeholder"):this.defaultLabel;var e='<input type="text" class="'+this.classes.sTagsInput.substring(1)+'" placeholder="'+this.defaultLabel+'">';this.selectors.sTagsInput=r(e).appendTo(this.selectors.inputArea).attr("autocomplete","off");var i='<div class="'+this.classes.listArea.substring(1)+'"></div>';this.selectors.listArea=r(i).appendTo(this.selectors.sTagsArea),r(this.selectors.listArea).width(r(this.selectors.sTagsArea).width()-3);var a='<ul class="'+this.classes.list.substring(1)+'"></ul>';this.selectors.list=r(a).appendTo(this.selectors.listArea),this.updateSuggestionList(),this.fixCSS()},updateSuggestionList:function(){r(this.selectors.list).html(""),r(this.createList()).appendTo(this.selectors.list)},setEvents:function(){var s=this;r(this.selectors.inputArea).attr("style",r(this.selector).attr("style")).addClass(r(this.selector).attr("class")),this.setTagEvents(),e!==o&&r(e).resize(function(){r(s.selectors.listArea).width(r(s.selectors.sTagsArea).width()-3)}),this.setSuggestionsEvents(),this.setRemoveEvent()},setTagEvents:function(){var a=this;r(this.selectors.sTagsInput).focus(function(){a.settings.showAllSuggestions&&a.suggestWhiteList("",0,!0),r(this).closest(a.classes.inputArea).addClass(a.classes.focus.substring(1)),"materialize"==a.settings.type&&r(this).css({"border-bottom":"none","-webkit-box-shadow":"none","box-shadow":"none"})}),r(this.selectors.sTagsInput).blur(function(){r(this).closest(a.classes.inputArea).removeClass(a.classes.focus.substring(1)),r(this).val()||r(a.selectors.listArea).hide()}),r(this.selectors.sTagsInput).keyup(function(s){var t=s.keyCode?s.keyCode:s.which;if("13"==t||"188"==t){var e=r.trim(r(this).val().replace(/,/g,""));r(this).val(""),a.addTag(a.getValue(e)),a.settings.showAllSuggestions&&a.suggestWhiteList("",0,!0)}else if("8"!=t||r(this).val())(a.settings.suggestions.length||a.isSuggestAction())&&(r(this).val()||a.settings.showAllSuggestions)&&(r(this).removeClass(a.classes.readyToRemove.substring(1)),a.processWhiteList(t,r(this).val()));else{var i=a.classes.readyToRemove.substring(1);r(this).hasClass(i)?($item=r(this).closest(a.classes.inputArea).find(a.classes.tagItem+":last"),a.removeTagByItem($item,!1)):r(this).addClass(i),r(a.selectors.listArea).hide(),a.settings.showAllSuggestions&&a.suggestWhiteList("",0,!0)}}),r(this.selectors.sTagsInput).keypress(function(s){if(13==(s.keyCode?s.keyCode:s.which))return!1}),r(this.selectors.sTagsArea).click(function(){r(a.selectors.sTagsInput).focus()})},setSuggestionsEvents:function(){var s=this;this.settings.selectOnHover&&r(this.selectors.listArea).find(this.classes.listItem).hover(function(){r(s.selectors.listArea).find(s.classes.listItem).removeClass("active"),r(this).addClass("active"),r(s.selectors.sTagsInput).val(r(this).text())},function(){r(this).removeClass("active")}),r(this.selectors.listArea).find(this.classes.listItem).click(function(){s.addTag(r(this).data("val")),r(s.selectors.sTagsInput).val("").focus()})},isSuggestAction:function(){return this.settings.suggestionsAction&&this.settings.suggestionsAction.url},getTag:function(e){if(this.settings.suggestions.length){var i=e;return r.each(this.settings.suggestions,function(s,t){return"object"==typeof t&&t.value==e?(i=t.tag,!1):t!=e&&void 0}),i}return e},getValue:function(s){if(this.settings.suggestions.length){var e=s,i=s.toString().toLowerCase();return r.each(this.settings.suggestions,function(s,t){return"object"==typeof t&&t.tag.toString().toLowerCase()==i?(e=t.value,!1):t.toString().toLowerCase()!=i&&void 0}),e}return s},processAjaxSuggestion:function(t,e){var i=this,s=this.getActionURL(this.settings.suggestionsAction.url),a={existing:this.settings.suggestions,term:t},n=(this.settings.suggestionsAction.callbacks&&this.settings.suggestionsAction.callbacks,{url:s+"?"+r.param(a)});this.settings.suggestionsAction.beforeSend!==o&&"function"==typeof this.settings.suggestionsAction.beforeSend&&(n.beforeSend=this.settings.suggestionsAction.beforeSend),n.success=function(s){s&&s.suggestions&&(i.settings.suggestions=r.merge(i.settings.suggestions,s.suggestions),i.settings.suggestions=i.unique(i.settings.suggestions),i.updateSuggestionList(),i.setSuggestionsEvents(),i.suggestWhiteList(t,e)),i.settings.suggestionsAction.success!==o&&"function"==typeof i.settings.suggestionsAction.success&&i.settings.suggestionsAction.success(s)},this.settings.suggestionsAction.error!==o&&"function"==typeof this.settings.suggestionsAction.error&&(n.error=this.settings.suggestionsAction.error),n.complete=function(s){i.settings.suggestionsAction.complete!==o&&"function"==typeof i.settings.suggestionsAction.complete&&i.settings.suggestionsAction.complete(s),i.ajaxActive=!1},r.ajax(n)},processWhiteList:function(s,t){if("40"==s||"38"==s){var e="40"==s?"down":"up";this.upDownSuggestion(t,e)}else this.isSuggestAction()&&!this.ajaxActive?(this.ajaxActive=!0,this.processAjaxSuggestion(t,s)):this.suggestWhiteList(t,s)},upDownSuggestion:function(s,t){var e=this,i=!1;if(r(this.selectors.listArea).find(this.classes.listItem+":visible").each(function(){if(r(this).hasClass("active"))return r(this).removeClass("active"),$item="up"==t?r(this).prevAll(e.classes.listItem+":visible:first"):r(this).nextAll(e.classes.listItem+":visible:first"),$item.length&&(i=!0,$item.addClass("active"),r(e.selectors.sTagsInput).val($item.text())),!1}),!i){var a="down"==t?"first":"last";$item=r(this.selectors.listArea).find(this.classes.listItem+":visible:"+a),$item.length&&($item.addClass("active"),r(e.selectors.sTagsInput).val($item.text()))}},suggestWhiteList:function(t,s,e){var i=this,a=!1,n=!!e,o=t.toString().toLowerCase();r(this.selectors.listArea).find(i.classes.noSuggestion).hide(),r(this.selectors.listArea).find(this.classes.listItem).each(function(){var s=r(this).data("val");r.isNumeric(s)&&(s=(-1==t.toString().indexOf(".")?parseInt:parseFloat)(s)),(n||~r(this).text().toString().toLowerCase().indexOf(o))&&-1===r.inArray(s,i.tagNames)?(r(this).show(),a=!0):r(this).hide()}),a?(r(this.selectors.listArea).show(),$item=r(this.selectors.listArea).find(this.classes.listItem+":visible"),1==$item.length&&"8"!=s?(this.settings.whiteList&&this.isSimilarText(t.toLowerCase(),$item.text().toLowerCase(),40)||this.isSimilarText(t.toLowerCase(),$item.text().toLowerCase(),60))&&($item.addClass("active"),r(this.selectors.sTagsInput).val($item.text())):$item.removeClass("active")):t&&i.settings.noSuggestionMsg?(r(this.selectors.listArea).find(i.classes.listItem).hide(),r(this.selectors.listArea).find(i.classes.noSuggestion).show()):r(this.selectors.listArea).hide()},setDefault:function(){var e=this,s=r(this.selector).val().split(",");s.length&&r.each(s,function(s,t){e.addTag(r.trim(t))})},setRemoveEvent:function(){var t=this;r(this.selectors.inputArea).find(this.classes.removeTag).click(function(s){s.stopImmediatePropagation(),$tagItem=r(this).closest(t.classes.tagItem),t.removeTagByItem($tagItem,!1)})},createList:function(){var a=this,n="";return r.each(this.settings.suggestions,function(s,t){var e="",i="";i="object"==typeof t?(e=t.value,t.tag):e=t,n+='<li class="'+a.classes.listItem.substring(1)+'" data-val="'+e+'">'+i+"</li>"}),a.settings.noSuggestionMsg&&(n+='<li class="'+a.classes.noSuggestion.substring(1)+'">'+a.settings.noSuggestionMsg+"</li>"),n},addTag:function(s){if(s){var t='<span class="'+this.classes.tagItem.substring(1)+'" data-val="'+s+'">'+this.getTag(s)+" "+this.setIcon()+"</span>";if($item=r(t).insertBefore(r(this.selectors.sTagsInput)),this.settings.defaultTagClass&&$item.addClass(this.settings.defaultTagClass),-1!=this.settings.tagLimit&&0<this.settings.tagLimit&&this.tagNames.length>=this.settings.tagLimit)return this.animateRemove($item,!0),this.flashItem(s),!1;var e=this.getItemKey(s);if(this.settings.whiteList&&-1===e)return this.animateRemove($item,!0),this.flashItem(s),!1;if(this.isPresent(s))this.animateRemove($item,!0),this.flashItem(s);else{this.customStylings($item,e);var i=s;r.isNumeric(i)&&(i=(-1==s.toString().indexOf(".")?parseInt:parseFloat)(i)),this.tagNames.push(i),this.setRemoveEvent(),this.setInputValue(),this.settings.afterAdd&&"function"==typeof this.settings.afterAdd&&this.settings.afterAdd(s)}r(this.selector).trigger("suggestags.add",[s]),r(this.selector).trigger("suggestags.change"),this.settings.triggerChange&&r(this.selector).trigger("change"),r(this.selectors.listArea).find(this.classes.listItem).removeClass("active"),r(this.selectors.listArea).hide(),r(this.selectors.sTagsInput).removeClass(this.classes.readyToRemove.substring(1))}},getItemKey:function(s){var e=-1;if(this.settings.suggestions.length){var i=s.toString().toLowerCase();r.each(this.settings.suggestions,function(s,t){if("object"==typeof t){if(t.value.toString().toLowerCase()==i)return e=s,!1}else if(t.toString().toLowerCase()==i)return e=s,!1})}return e},isPresent:function(e){var i=!1;return r.each(this.tagNames,function(s,t){if(e.toString().toLowerCase()==t.toString().toLowerCase())return!(i=!0)}),i},customStylings:function(s,t){var e=!1;this.settings.classes[t]&&(e=!0,r(s).addClass(this.settings.classes[t])),this.settings.backgrounds[t]&&(e=!0,r(s).css("background",this.settings.backgrounds[t])),this.settings.colors[t]&&(e=!0,r(s).css("color",this.settings.colors[t])),e||r(s).addClass(this.classes.colBg.substring(1))},removeTag:function(s){var t=this;$findTags=r(this.selectors.sTagsArea).find('[data-val="'+s+'"]'),$findTags.length&&$findTags.each(function(){t.removeTagByItem(this,!0)})},removeTagByItem:function(s,t){this.tagNames.splice(r(s).index(),1),this.animateRemove(s,t),this.setInputValue(),r(this.selector).trigger("suggestags.remove",[r(s).attr("data-val")]),r(this.selector).trigger("suggestags.change"),this.settings.triggerChange&&r(this.selector).trigger("change"),this.settings.afterRemove&&"function"==typeof this.settings.afterRemove&&this.settings.afterRemove(r(s).attr("data-val")),r(this.selectors.sTagsInput).removeClass(this.classes.readyToRemove.substring(1))},animateRemove:function(s,t){r(s).addClass("disabled"),t?setTimeout(function(){r(s).slideUp(),setTimeout(function(){r(s).remove()},500)},500):r(s).remove()},flashItem:function(t){$item="",t=t.toString().toLowerCase(),r(this.selectors.sTagsArea).find(this.classes.tagItem).each(function(){var s=r.trim(r(this).attr("data-val"));if(t==s.toString().toLowerCase())return $item=r(this),!1}),$item&&($item.addClass("flash"),setTimeout(function(){$item.removeClass("flash")},1500))},setIcon:function(){var s=this.classes.removeTag.substring(1);return"bootstrap"==this.settings.type?'<span class="fa fa-times '+s+'"></span>':"materialize"==this.settings.type?'<i class="material-icons right '+s+'">clear</i>':'<b class="'+s+'">&#10006;</b>'},setInputValue:function(){r(this.selector).val(this.tagNames.join(",")),this.printValues()},fixCSS:function(){"amsify"==this.settings.type?r(this.selectors.inputArea).addClass(this.classes.inputAreaDef.substring(1)).css({padding:"5px 5px"}):"materialize"==this.settings.type&&(r(this.selectors.inputArea).addClass(this.classes.inputAreaDef.substring(1)).css({height:"auto",padding:"5px 5px"}),r(this.selectors.sTagsInput).css({margin:"0",height:"auto"}))},printValues:function(){console.info(this.tagNames,r(this.selector).val())},checkMethod:function(){return $findTags=r(this.selector).next(this.classes.sTagsArea),$findTags.length&&$findTags.remove(),r(this.selector).show(),typeof this.method===o||"destroy"!=this.method},refresh:function(){this._setMethod("refresh"),this._init()},destroy:function(){this._setMethod("destroy"),this._init()},getActionURL:function(s){var t="";return e!==o&&(t=e.location.protocol+"//"+e.location.host),this.isAbsoluteURL(s)?t=s:t+="/"+s.replace(/^\/|\/$/g,""),t},isAbsoluteURL:function(s){return!!new RegExp("^(?:[a-z]+:)?//","i").test(s)},unique:function(s){var e=[],i=this;return r.each(s,function(s,t){"object"==typeof t?i.objectInArray(t,e)||e.push(t):-1==r.inArray(t,e)&&e.push(t)}),e},objectInArray:function(e,s){if(s.length){var i=!1;return r.each(s,function(s,t){if("object"==typeof t){if(t.value==e.value)return!(i=!0)}else if(t==e.value)return!(i=!0)}),i}return!1},isSimilarText:function(s,t,e){return e<=100*this.similarity(s,t)},similarity:function(s,t){var e=s,i=t;s.length<t.length&&(e=t,i=s);var a=e.length;return 0==a?1:(a-this.editDistance(e,i))/parseFloat(a)},editDistance:function(s,t){s=s.toLowerCase(),t=t.toLowerCase();for(var e=new Array,i=0;i<=s.length;i++){for(var a=i,n=0;n<=t.length;n++)if(0==i)e[n]=n;else if(0<n){var o=e[n-1];s.charAt(i-1)!=t.charAt(n-1)&&(o=Math.min(Math.min(o,a),e[n])+1),e[n-1]=a,a=o}0<i&&(e[t.length]=a)}return e[t.length]}},r.fn.amsifySuggestags=function(t,e){return this.each(function(){var s=new AmsifySuggestags(this);s._settings(t),s._setMethod(e),s._init()})}});